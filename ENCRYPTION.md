# å¯†ç åŠ å¯†ç™»å½•åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è¿°

ä¸ºäº†å¢å¼ºç™»å½•å®‰å…¨æ€§ï¼Œç³»ç»Ÿå®ç°äº†RSAéå¯¹ç§°åŠ å¯†ç™»å½•åŠŸèƒ½ã€‚å‰ç«¯ä½¿ç”¨RSAå…¬é’¥åŠ å¯†å¯†ç ï¼Œåç«¯ä½¿ç”¨RSAç§é’¥è§£å¯†åå†è¿›è¡ŒéªŒè¯ã€‚

## ğŸ” åŠ å¯†æµç¨‹

1. **å‰ç«¯è·å–å…¬é’¥**ï¼šç™»å½•æ—¶ï¼Œå‰ç«¯é¦–å…ˆä»åç«¯è·å–RSAå…¬é’¥
2. **åŠ å¯†å¯†ç **ï¼šå‰ç«¯ä½¿ç”¨å…¬é’¥åŠ å¯†ç”¨æˆ·è¾“å…¥çš„æ˜æ–‡å¯†ç 
3. **å‘é€åŠ å¯†æ•°æ®**ï¼šå°†åŠ å¯†åçš„å¯†ç ï¼ˆBase64ç¼–ç ï¼‰å‘é€åˆ°åç«¯
4. **åç«¯è§£å¯†**ï¼šåç«¯ä½¿ç”¨RSAç§é’¥è§£å¯†å¯†ç 
5. **éªŒè¯ç™»å½•**ï¼šä½¿ç”¨è§£å¯†åçš„å¯†ç è¿›è¡Œæ­£å¸¸çš„ç™»å½•éªŒè¯

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### åç«¯å®ç°

#### 1. RSAå¯†é’¥ç®¡ç†
- ä½ç½®ï¼š`backend/app/core/security.py`
- åŠŸèƒ½ï¼š
  - è‡ªåŠ¨ç”ŸæˆRSAå¯†é’¥å¯¹ï¼ˆ2048ä½ï¼‰
  - æ”¯æŒä»ç¯å¢ƒå˜é‡åŠ è½½å¯†é’¥
  - æä¾›å…¬é’¥è·å–æ¥å£
  - æä¾›å¯†ç è§£å¯†åŠŸèƒ½

#### 2. APIæ¥å£

**è·å–å…¬é’¥**
```
GET /api/v1/auth/public-key
```

å“åº”ç¤ºä¾‹ï¼š
```json
{
  "public_key": "-----BEGIN PUBLIC KEY-----\n...\n-----END PUBLIC KEY-----",
  "algorithm": "RSA-OAEP",
  "key_size": 2048
}
```

**åŠ å¯†ç™»å½•**
```
POST /api/v1/auth/login-encrypted
Content-Type: application/json

{
  "username": "admin",
  "encrypted_password": "Base64ç¼–ç çš„åŠ å¯†å¯†ç "
}
```

### å‰ç«¯å®ç°

#### 1. åŠ å¯†å·¥å…·
- ä½ç½®ï¼š`frontend/src/utils/encryption.js`
- åŠŸèƒ½ï¼š
  - ä»åç«¯è·å–RSAå…¬é’¥
  - ä½¿ç”¨JSEncryptåº“è¿›è¡ŒRSAåŠ å¯†
  - å…¬é’¥ç¼“å­˜ï¼ˆ24å°æ—¶æœ‰æ•ˆæœŸï¼‰

#### 2. ç™»å½•æµç¨‹
- ä½ç½®ï¼š`frontend/src/utils/auth.js`
- æµç¨‹ï¼š
  1. è°ƒç”¨ `encryptPassword()` åŠ å¯†å¯†ç 
  2. å‘é€åŠ å¯†åçš„å¯†ç åˆ° `/api/v1/auth/login-encrypted`
  3. ä¿å­˜è¿”å›çš„token

## ğŸ“¦ ä¾èµ–å®‰è£…

### åç«¯ä¾èµ–
å·²åœ¨ `requirements.txt` ä¸­æ·»åŠ ï¼š
```
cryptography==41.0.7
```

### å‰ç«¯ä¾èµ–
éœ€è¦åœ¨ `package.json` ä¸­æ·»åŠ ï¼š
```json
{
  "dependencies": {
    "jsencrypt": "^3.3.2",
    "axios": "^1.6.2"
  }
}
```

å®‰è£…å‘½ä»¤ï¼š
```bash
cd frontend
npm install
```

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¼€å‘ç¯å¢ƒ

1. **å¯åŠ¨åç«¯æœåŠ¡**
```bash
cd backend
python main.py
```

2. **å¯åŠ¨å‰ç«¯æœåŠ¡**
```bash
cd frontend
npm install  # é¦–æ¬¡è¿è¡Œéœ€è¦å®‰è£…ä¾èµ–
npm run dev
```

3. **æµ‹è¯•ç™»å½•**
   - è®¿é—® `http://localhost:3000/login`
   - è¾“å…¥ç”¨æˆ·åå’Œå¯†ç 
   - ç³»ç»Ÿä¼šè‡ªåŠ¨åŠ å¯†å¯†ç å¹¶å‘é€åˆ°åç«¯

### ç”Ÿäº§ç¯å¢ƒ

1. **é…ç½®RSAå¯†é’¥ï¼ˆå¯é€‰ï¼‰**

å¦‚æœéœ€è¦ä½¿ç”¨å›ºå®šçš„RSAå¯†é’¥å¯¹ï¼Œå¯ä»¥åœ¨ç¯å¢ƒå˜é‡ä¸­é…ç½®ï¼š

```bash
# ç”ŸæˆRSAå¯†é’¥å¯¹
openssl genrsa -out private_key.pem 2048
openssl rsa -in private_key.pem -pubout -out public_key.pem

# åœ¨ .env æ–‡ä»¶ä¸­é…ç½®
RSA_PRIVATE_KEY=$(cat private_key.pem)
RSA_PUBLIC_KEY=$(cat public_key.pem)
```

2. **Dockeréƒ¨ç½²**

ä½¿ç”¨Docker Composeéƒ¨ç½²æ—¶ï¼Œå¯†é’¥ä¼šè‡ªåŠ¨ç”Ÿæˆã€‚å¦‚æœéœ€è¦æŒä¹…åŒ–å¯†é’¥ï¼Œå¯ä»¥ï¼š

```yaml
# docker-compose.yml
services:
  backend:
    volumes:
      - ./rsa_keys:/app/rsa_keys
    environment:
      - RSA_PRIVATE_KEY_FILE=/app/rsa_keys/private_key.pem
      - RSA_PUBLIC_KEY_FILE=/app/rsa_keys/public_key.pem
```

## ğŸ”’ å®‰å…¨è¯´æ˜

### ä¼˜åŠ¿

1. **ä¼ è¾“å®‰å…¨**ï¼šå¯†ç åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯åŠ å¯†çš„ï¼Œå³ä½¿è¢«æ‹¦æˆªä¹Ÿæ— æ³•ç›´æ¥è·å–æ˜æ–‡
2. **éå¯¹ç§°åŠ å¯†**ï¼šä½¿ç”¨RSAéå¯¹ç§°åŠ å¯†ï¼Œå…¬é’¥å¯ä»¥å…¬å¼€ï¼Œç§é’¥åªåœ¨åç«¯ä¿å­˜
3. **å¯†é’¥ç®¡ç†**ï¼šåç«¯è‡ªåŠ¨ç®¡ç†å¯†é’¥å¯¹ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®

### æ³¨æ„äº‹é¡¹

1. **HTTPSæ¨è**ï¼šè™½ç„¶å¯†ç å·²åŠ å¯†ï¼Œä½†ç”Ÿäº§ç¯å¢ƒä»å»ºè®®ä½¿ç”¨HTTPS
2. **å¯†é’¥å®‰å…¨**ï¼šå¦‚æœä½¿ç”¨å›ºå®šå¯†é’¥ï¼Œè¯·å¦¥å–„ä¿ç®¡ç§é’¥
3. **ç¼“å­˜æœºåˆ¶**ï¼šå‰ç«¯ä¼šç¼“å­˜å…¬é’¥24å°æ—¶ï¼Œå‡å°‘è¯·æ±‚æ¬¡æ•°

## ğŸ§ª æµ‹è¯•

### æµ‹è¯•åŠ å¯†ç™»å½•

```bash
# 1. è·å–å…¬é’¥
curl http://localhost:8000/api/v1/auth/public-key

# 2. ä½¿ç”¨å…¬é’¥åŠ å¯†å¯†ç ï¼ˆéœ€è¦åœ¨å‰ç«¯æˆ–ä½¿ç”¨å·¥å…·ï¼‰
# 3. å‘é€åŠ å¯†ç™»å½•è¯·æ±‚
curl -X POST http://localhost:8000/api/v1/auth/login-encrypted \
  -H "Content-Type: application/json" \
  -d '{
    "username": "admin",
    "encrypted_password": "åŠ å¯†åçš„å¯†ç "
  }'
```

### å‰ç«¯æµ‹è¯•

1. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…·
2. è®¿é—®ç™»å½•é¡µé¢
3. åœ¨Networkæ ‡ç­¾ä¸­æŸ¥çœ‹è¯·æ±‚
4. ç¡®è®¤å¯†ç å­—æ®µæ˜¯åŠ å¯†çš„ï¼ˆBase64å­—ç¬¦ä¸²ï¼‰

## ğŸ”„ å…¼å®¹æ€§

ç³»ç»ŸåŒæ—¶æ”¯æŒä¸¤ç§ç™»å½•æ–¹å¼ï¼š

1. **åŠ å¯†ç™»å½•**ï¼ˆæ¨èï¼‰ï¼š`/api/v1/auth/login-encrypted`
2. **æ™®é€šç™»å½•**ï¼ˆå…¼å®¹ï¼‰ï¼š`/api/v1/auth/login-json`

å‰ç«¯é»˜è®¤ä½¿ç”¨åŠ å¯†ç™»å½•æ–¹å¼ã€‚

## ğŸ“ ä»£ç ç¤ºä¾‹

### å‰ç«¯åŠ å¯†ç™»å½•

```javascript
import { login } from '@/utils/auth.js'

// ç™»å½•
const result = await login('admin', 'admin123')
if (result.success) {
  console.log('ç™»å½•æˆåŠŸ')
} else {
  console.error('ç™»å½•å¤±è´¥:', result.message)
}
```

### åç«¯è§£å¯†éªŒè¯

```python
from app.core.security import decrypt_password, verify_password

# è§£å¯†å¯†ç 
decrypted_password = decrypt_password(encrypted_password)

# éªŒè¯å¯†ç 
is_valid = verify_password(decrypted_password, user.hashed_password)
```

## ğŸ› æ•…éšœæ’æŸ¥

### é—®é¢˜1ï¼šå‰ç«¯åŠ å¯†å¤±è´¥

**ç—‡çŠ¶**ï¼šæ§åˆ¶å°æ˜¾ç¤º"å¯†ç åŠ å¯†å¤±è´¥"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¡®ä¿èƒ½è®¿é—®åç«¯API
2. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
3. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒlocalStorageä¸­çš„å…¬é’¥ç¼“å­˜

### é—®é¢˜2ï¼šåç«¯è§£å¯†å¤±è´¥

**ç—‡çŠ¶**ï¼šè¿”å›"å¯†ç è§£å¯†å¤±è´¥"

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥å‰ç«¯ä½¿ç”¨çš„å…¬é’¥æ˜¯å¦ä¸åç«¯ç§é’¥åŒ¹é…
2. æ¸…é™¤å‰ç«¯å…¬é’¥ç¼“å­˜ï¼Œé‡æ–°è·å–
3. æ£€æŸ¥åŠ å¯†ç®—æ³•æ˜¯å¦ä¸€è‡´ï¼ˆRSA-OAEPï¼‰

### é—®é¢˜3ï¼šç™»å½•ä¸€ç›´å¤±è´¥

**ç—‡çŠ¶**ï¼šå³ä½¿å¯†ç æ­£ç¡®ä¹Ÿç™»å½•å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**ï¼š
1. æ£€æŸ¥åç«¯æ—¥å¿—ï¼ŒæŸ¥çœ‹è§£å¯†æ˜¯å¦æˆåŠŸ
2. ç¡®è®¤ä½¿ç”¨çš„æ˜¯åŠ å¯†ç™»å½•æ¥å£ `/api/v1/auth/login-encrypted`
3. æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç æ˜¯å¦æ­£ç¡®

## ğŸ“š ç›¸å…³æ–‡ä»¶

- åç«¯åŠ å¯†å·¥å…·ï¼š`backend/app/core/security.py`
- åç«¯ç™»å½•æ¥å£ï¼š`backend/app/api/v1/auth.py`
- å‰ç«¯åŠ å¯†å·¥å…·ï¼š`frontend/src/utils/encryption.js`
- å‰ç«¯ç™»å½•å·¥å…·ï¼š`frontend/src/utils/auth.js`
- å‰ç«¯APIå·¥å…·ï¼š`frontend/src/utils/api.js`

